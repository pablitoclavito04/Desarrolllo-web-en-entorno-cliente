<div class="container">
  <h2>Registro Avanzado con Validaci√≥n Asincr√≥nica</h2>
  
  <form [formGroup]="registroForm" (ngSubmit)="onSubmit()">
    
    <!-- Username -->
    <div class="form-group">
      <label for="username">Username:</label>
      <div class="input-wrapper">
        <input 
          type="text" 
          id="username" 
          formControlName="username"
          class="form-control"
          [class.invalid]="username?.invalid && username?.touched"
          [class.validating]="mostrarCargando('username')">
        
        <span *ngIf="mostrarCargando('username')" class="spinner">
          ‚è≥ Verificando...
        </span>
      </div>
      
      <div *ngIf="username?.invalid && username?.touched" class="error-message">
        <small *ngIf="username?.errors?.['required']">Requerido</small>
        <small *ngIf="username?.errors?.['minlength']">M√≠nimo 3 caracteres</small>
        <small *ngIf="username?.errors?.['usernameReservado']">Username no disponible (reservado)</small>
      </div>
    </div>

    <!-- Email -->
    <div class="form-group">
      <label for="email">Email:</label>
      <div class="input-wrapper">
        <input 
          type="email" 
          id="email" 
          formControlName="email"
          class="form-control"
          [class.invalid]="email?.invalid && email?.touched"
          [class.validating]="mostrarCargando('email')">
        
        <span *ngIf="mostrarCargando('email')" class="spinner">
          ‚è≥ Verificando disponibilidad...
        </span>
      </div>
      
      <div *ngIf="email?.invalid && email?.touched" class="error-message">
        <small *ngIf="email?.errors?.['required']">Requerido</small>
        <small *ngIf="email?.errors?.['email']">Email inv√°lido</small>
        <small *ngIf="email?.errors?.['emailExiste']">Este email ya est√° registrado</small>
      </div>
      
      <div *ngIf="mostrarCargando('email')" class="info-message">
        <small>Validando disponibilidad del email...</small>
      </div>
    </div>

    <!-- Contrase√±a -->
    <div class="form-group">
      <label for="password">Contrase√±a:</label>
      <input 
        type="password" 
        id="password" 
        formControlName="password"
        class="form-control"
        [class.invalid]="password?.invalid && password?.touched">
      
      <div *ngIf="password?.invalid && password?.touched" class="error-message">
        <small *ngIf="password?.errors?.['required']">Requerida</small>
        <small *ngIf="password?.errors?.['minlength']">M√≠nimo 8 caracteres</small>
      </div>
    </div>

    <!-- T√©rminos y Condiciones -->
    <div class="form-group-checkbox">
      <label>
        <input 
          type="checkbox" 
          formControlName="terminos"
          class="checkbox">
        Acepto los t√©rminos y condiciones
      </label>
      
      <div *ngIf="terminos?.invalid && terminos?.touched" class="error-message">
        <small>Debes aceptar los t√©rminos</small>
      </div>
    </div>

    <!-- Bot√≥n Submit -->
    <button 
      type="submit" 
      class="btn-submit"
      [disabled]="registroForm.invalid || registroForm.pending || enviando">
      {{ enviando ? 'Registrando...' : 'Crear Cuenta' }}
    </button>

    <!-- Indicador de validaci√≥n global -->
    <div *ngIf="registroForm.pending" class="validating-message">
      <span class="spinner-global">‚è≥</span> Validando informaci√≥n...
    </div>
  </form>

  <!-- Informaci√≥n de prueba -->
  <div class="info-panel">
    <h3>üí° Informaci√≥n para pruebas:</h3>
    <ul>
      <li><strong>Emails ya registrados:</strong> admin@example.com, usuario@example.com, test@example.com</li>
      <li><strong>Usernames reservados:</strong> Los que empiezan con "admin" (ej: admin123)</li>
      <li><strong>Validaci√≥n asincr√≥nica:</strong> Simula 1 segundo de espera para verificar disponibilidad</li>
    </ul>
  </div>
</div>