<div class="container">
  <h2>ğŸ›¡ï¸ Actividad 4: Route Guards (CanActivate)</h2>
  <p class="description">
    ImplementaciÃ³n de guards para proteger rutas y controlar el acceso mediante autenticaciÃ³n.
  </p>

  <!-- Estado de autenticaciÃ³n -->
  <div class="status-banner" [class.authenticated]="isAuthenticated" [class.not-authenticated]="!isAuthenticated">
    <span *ngIf="isAuthenticated">âœ… SesiÃ³n iniciada</span>
    <span *ngIf="!isAuthenticated">ğŸ”’ No has iniciado sesiÃ³n</span>
  </div>

  <!-- Formulario de Login -->
  <div class="login-section" *ngIf="!isAuthenticated">
    <h3>ğŸ”‘ Iniciar SesiÃ³n</h3>
    
    <form (submit)="onLogin($event)" class="login-form">
      <div class="form-group">
        <label>Usuario:</label>
        <input
          type="text"
          #username
          name="username"
          placeholder="admin"
          class="form-control"
          required>
      </div>

      <div class="form-group">
        <label>ContraseÃ±a:</label>
        <input
          type="password"
          #password
          name="password"
          placeholder="1234"
          class="form-control"
          required>
      </div>

      <div *ngIf="loginError" class="error-message">
        âŒ Credenciales incorrectas. Intenta con: <strong>admin / 1234</strong>
      </div>

      <button type="submit" class="btn-login">
        ğŸ”“ Iniciar SesiÃ³n
      </button>
    </form>

    <div class="credentials-hint">
      <p>ğŸ’¡ <strong>Credenciales de prueba:</strong></p>
      <p>Usuario: <code>admin</code> | ContraseÃ±a: <code>1234</code></p>
    </div>
  </div>

  <!-- Panel de usuario autenticado -->
  <div class="authenticated-section" *ngIf="isAuthenticated">
    <h3>âœ… Â¡Bienvenido!</h3>
    <p>Has iniciado sesiÃ³n correctamente. Ahora puedes acceder a la zona protegida.</p>

    <div class="actions">
      <button class="btn-protected" (click)="goToProtected()">
        ğŸ›¡ï¸ Ir a Zona Protegida
      </button>
      <button class="btn-logout" (click)="onLogout()">
        ğŸšª Cerrar SesiÃ³n
      </button>
    </div>
  </div>

  <!-- InformaciÃ³n de la actividad -->
  <div class="info-box">
    <h4>ğŸ“š Conceptos abordados:</h4>
    <ul>
      <li><strong>CanActivate:</strong> Guard funcional que protege rutas</li>
      <li><strong>AuthService:</strong> Servicio de autenticaciÃ³n simulada</li>
      <li><strong>inject():</strong> InyecciÃ³n de dependencias en guards funcionales</li>
      <li><strong>Router.navigate():</strong> RedirecciÃ³n programÃ¡tica</li>
    </ul>
  </div>

  <!-- ExplicaciÃ³n tÃ©cnica -->
  <div class="technical-info">
    <h4>ğŸ”§ ImplementaciÃ³n TÃ©cnica</h4>
    <div class="code-block">
      <h5>En app.routes.ts:</h5>
      <pre><code>&#123;
  path: 'zona-protegida',
  component: ZonaProtegidaComponent,
  canActivate: [authGuard]  // â† Guard protege esta ruta
&#125;</code></pre>
    </div>

    <div class="code-block">
      <h5>En auth.guard.ts:</h5>
      <pre><code>export const authGuard: CanActivateFn = (route, state) => &#123;
  const authService = inject(AuthService);
  
  if (authService.isLoggedIn()) &#123;
    return true;  // Permite acceso
  &#125;
  
  return router.createUrlTree(['/actividad4']);  // Redirige
&#125;;</code></pre>
    </div>
  </div>

  <!-- Instrucciones -->
  <div class="instructions">
    <h4>ğŸ§ª CÃ³mo Probar:</h4>
    <ol>
      <li>Intenta acceder a la <strong>Zona Protegida</strong> sin hacer login (serÃ¡s bloqueado)</li>
      <li>Inicia sesiÃ³n con <code>admin</code> / <code>1234</code></li>
      <li>Ahora sÃ­ podrÃ¡s acceder a la Zona Protegida</li>
      <li>Cierra sesiÃ³n y verifica que ya no tienes acceso</li>
    </ol>
  </div>
</div>
